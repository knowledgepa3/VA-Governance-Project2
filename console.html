<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GIA Console | Governed AI Terminal</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0d0d0d;
      --bg-secondary: #141414;
      --bg-tertiary: #1a1a1a;
      --border: #2a2a2a;
      --text: #e4e4e7;
      --text-dim: #71717a;
      --text-bright: #fafafa;
      --accent: #8b5cf6;
      --accent-dim: #7c3aed;
      --green: #22c55e;
      --green-dim: #16a34a;
      --yellow: #eab308;
      --red: #ef4444;
      --blue: #3b82f6;
      --cyan: #06b6d4;
      --orange: #f97316;
      --pink: #ec4899;

      --font-mono: 'JetBrains Mono', 'Fira Code', 'Consolas', monospace;
      --font-sans: 'Inter', -apple-system, sans-serif;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      height: 100%;
      overflow: hidden;
    }

    body {
      font-family: var(--font-mono);
      background: var(--bg);
      color: var(--text);
      display: flex;
      flex-direction: column;
    }

    /* Header */
    .header {
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border);
      padding: 0.6rem 1rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-shrink: 0;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-weight: 700;
      font-size: 0.9rem;
      color: var(--text-bright);
    }

    .logo-icon {
      width: 24px;
      height: 24px;
      background: linear-gradient(135deg, var(--accent) 0%, var(--green) 100%);
      border-radius: 5px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
    }

    .workflow-tag {
      font-size: 0.75rem;
      color: var(--text-dim);
      background: var(--bg-tertiary);
      padding: 0.3rem 0.6rem;
      border-radius: 4px;
      border: 1px solid var(--border);
    }

    .status-pill {
      display: flex;
      align-items: center;
      gap: 0.4rem;
      font-size: 0.7rem;
      padding: 0.3rem 0.6rem;
      border-radius: 12px;
      font-weight: 500;
    }

    .status-pill.running {
      background: rgba(34, 197, 94, 0.15);
      color: var(--green);
    }

    .status-pill.paused {
      background: rgba(234, 179, 8, 0.15);
      color: var(--yellow);
    }

    .status-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: currentColor;
    }

    .status-pill.running .status-dot {
      animation: blink 1s ease-in-out infinite;
    }

    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.3; }
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .header-btn {
      font-family: var(--font-mono);
      font-size: 0.7rem;
      padding: 0.4rem 0.7rem;
      border-radius: 4px;
      border: 1px solid var(--border);
      background: var(--bg-tertiary);
      color: var(--text-dim);
      cursor: pointer;
      transition: all 0.15s;
    }

    .header-btn:hover {
      background: var(--border);
      color: var(--text);
    }

    .header-btn.danger {
      border-color: rgba(239, 68, 68, 0.3);
      color: var(--red);
    }

    .header-btn.danger:hover {
      background: rgba(239, 68, 68, 0.15);
    }

    .mode-tag {
      font-size: 0.65rem;
      font-weight: 600;
      padding: 0.25rem 0.5rem;
      border-radius: 3px;
      background: rgba(59, 130, 246, 0.15);
      color: var(--blue);
      border: 1px solid rgba(59, 130, 246, 0.3);
    }

    .mode-tag.live {
      background: rgba(239, 68, 68, 0.15);
      color: var(--red);
      border-color: rgba(239, 68, 68, 0.3);
    }

    .cost-tag {
      font-size: 0.7rem;
      font-family: var(--font-mono);
      color: var(--green);
      padding: 0.3rem 0.6rem;
      background: rgba(34, 197, 94, 0.1);
      border-radius: 4px;
      border: 1px solid rgba(34, 197, 94, 0.2);
    }

    .cost-tag.warning {
      color: var(--yellow);
      background: rgba(234, 179, 8, 0.1);
      border-color: rgba(234, 179, 8, 0.2);
    }

    .cost-tag.danger {
      color: var(--red);
      background: rgba(239, 68, 68, 0.1);
      border-color: rgba(239, 68, 68, 0.2);
    }

    /* Governance Banner */
    .governance-banner {
      background: var(--bg-tertiary);
      border-bottom: 1px solid var(--border);
      padding: 0.5rem 1.5rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.75rem;
      flex-shrink: 0;
    }

    .gov-item {
      display: flex;
      align-items: center;
      gap: 0.35rem;
      color: var(--text-dim);
    }

    .gov-icon {
      font-size: 0.7rem;
    }

    .gov-divider {
      color: var(--border);
      margin: 0 0.25rem;
    }

    /* Metrics Bar */
    .metrics-bar {
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border);
      padding: 0.4rem 1.5rem;
      display: flex;
      align-items: center;
      gap: 1.5rem;
      font-size: 0.7rem;
      flex-shrink: 0;
      overflow-x: auto;
    }

    .metric-item {
      display: flex;
      flex-direction: column;
      gap: 0.15rem;
    }

    .metric-label {
      color: var(--text-dim);
      font-size: 0.6rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .metric-value {
      color: var(--text-bright);
      font-family: var(--font-mono);
      font-weight: 600;
    }

    .compliance-tag {
      margin-left: auto;
      padding: 0.3rem 0.6rem;
      background: rgba(6, 182, 212, 0.1);
      border: 1px solid rgba(6, 182, 212, 0.2);
      border-radius: 4px;
    }

    .compliance-tag .metric-value {
      color: var(--cyan);
      font-size: 0.65rem;
    }

    /* Capsule System */
    .capsule-block {
      background: var(--bg-secondary);
      border: 1px solid var(--pink);
      border-radius: 6px;
      margin: 0.75rem 0;
      overflow: hidden;
    }

    .capsule-header {
      background: rgba(236, 72, 153, 0.1);
      padding: 0.5rem 0.75rem;
      font-size: 0.75rem;
      color: var(--pink);
      border-bottom: 1px solid var(--pink);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .capsule-header-left {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .capsule-badge {
      font-size: 0.6rem;
      padding: 0.15rem 0.4rem;
      border-radius: 3px;
      font-weight: 600;
    }

    .capsule-badge.cached {
      background: rgba(34, 197, 94, 0.2);
      color: var(--green);
    }

    .capsule-badge.new {
      background: rgba(59, 130, 246, 0.2);
      color: var(--blue);
    }

    .capsule-badge.reusable {
      background: rgba(139, 92, 246, 0.2);
      color: var(--accent);
    }

    .capsule-content {
      padding: 0.75rem;
      font-size: 0.8rem;
    }

    .capsule-stats {
      display: flex;
      gap: 1rem;
      margin-top: 0.5rem;
      padding-top: 0.5rem;
      border-top: 1px solid var(--border);
      font-size: 0.7rem;
      color: var(--text-dim);
    }

    .capsule-stat {
      display: flex;
      align-items: center;
      gap: 0.3rem;
    }

    .capsule-stat-value {
      color: var(--text-bright);
      font-weight: 600;
    }

    /* Instruction Pack */
    .instruction-pack {
      background: var(--bg-secondary);
      border: 1px solid var(--orange);
      border-radius: 6px;
      margin: 0.75rem 0;
      overflow: hidden;
    }

    .instruction-header {
      background: rgba(249, 115, 22, 0.1);
      padding: 0.5rem 0.75rem;
      font-size: 0.75rem;
      color: var(--orange);
      border-bottom: 1px solid var(--orange);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .instruction-content {
      padding: 0.75rem;
    }

    .instruction-step {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 0.4rem;
      font-size: 0.8rem;
    }

    .instruction-step-num {
      color: var(--orange);
      font-weight: 600;
      min-width: 20px;
    }

    .instruction-step-text {
      color: var(--text);
    }

    .instruction-step.active .instruction-step-text {
      color: var(--text-bright);
    }

    .instruction-step.done .instruction-step-num {
      color: var(--green);
    }

    .instruction-step.done .instruction-step-text {
      color: var(--text-dim);
      text-decoration: line-through;
    }

    /* Gate Prompt */
    .gate-prompt {
      background: var(--bg-secondary);
      border: 1px solid var(--yellow);
      border-radius: 8px;
      padding: 1rem;
      margin: 1rem 0;
    }

    .gate-prompt-header {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      color: var(--yellow);
      font-weight: 600;
      margin-bottom: 0.75rem;
    }

    .gate-prompt-text {
      color: var(--text);
      margin-bottom: 1rem;
      line-height: 1.5;
    }

    .gate-prompt-actions {
      display: flex;
      gap: 0.5rem;
    }

    .gate-btn {
      font-family: var(--font-mono);
      font-size: 0.8rem;
      padding: 0.5rem 1rem;
      border-radius: 4px;
      border: 1px solid var(--border);
      background: var(--bg-tertiary);
      color: var(--text);
      cursor: pointer;
      transition: all 0.15s;
    }

    .gate-btn:hover {
      background: var(--border);
    }

    .gate-btn.primary {
      background: var(--green);
      border-color: var(--green);
      color: var(--bg);
    }

    .gate-btn.primary:hover {
      background: var(--green-dim);
    }

    .gate-btn.danger {
      border-color: var(--red);
      color: var(--red);
    }

    /* Evidence Pack Block */
    .evidence-block {
      background: var(--bg-secondary);
      border: 1px solid var(--accent);
      border-radius: 6px;
      margin: 0.75rem 0;
      overflow: hidden;
    }

    .evidence-header {
      background: rgba(139, 92, 246, 0.1);
      padding: 0.5rem 0.75rem;
      font-size: 0.75rem;
      color: var(--accent);
      border-bottom: 1px solid var(--accent);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .evidence-content {
      padding: 0.75rem;
      font-size: 0.8rem;
      color: var(--text-dim);
      line-height: 1.6;
    }

    .evidence-row {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 0.25rem;
    }

    .evidence-label {
      color: var(--text-dim);
      min-width: 100px;
    }

    .evidence-value {
      color: var(--text);
      font-family: var(--font-mono);
    }

    .evidence-pass {
      color: var(--green);
    }

    .evidence-warn {
      color: var(--yellow);
    }

    /* Main Terminal */
    .terminal-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      position: relative;
    }

    .terminal {
      flex: 1;
      overflow-y: auto;
      padding: 1rem 1.5rem;
      padding-bottom: 0;
      scroll-behavior: smooth;
    }

    .terminal::-webkit-scrollbar {
      width: 8px;
    }

    .terminal::-webkit-scrollbar-track {
      background: transparent;
    }

    .terminal::-webkit-scrollbar-thumb {
      background: var(--border);
      border-radius: 4px;
    }

    /* Terminal Lines */
    .line {
      display: flex;
      gap: 0.75rem;
      margin-bottom: 0.15rem;
      line-height: 1.6;
      font-size: 0.9rem;
    }

    .line-prefix {
      color: var(--text-dim);
      user-select: none;
      flex-shrink: 0;
      min-width: 20px;
    }

    .line-content {
      flex: 1;
      white-space: pre-wrap;
      word-break: break-word;
    }

    /* Line Types */
    .line.system .line-prefix { color: var(--accent); }
    .line.system .line-content { color: var(--text-dim); }

    .line.step .line-prefix { color: var(--green); }
    .line.step .line-content { color: var(--text); }

    .line.output .line-prefix { color: var(--text-dim); }
    .line.output .line-content { color: var(--text-dim); }

    .line.success .line-prefix { color: var(--green); }
    .line.success .line-content { color: var(--green); }

    .line.warning .line-prefix { color: var(--yellow); }
    .line.warning .line-content { color: var(--yellow); }

    .line.error .line-prefix { color: var(--red); }
    .line.error .line-content { color: var(--red); }

    .line.gate .line-prefix { color: var(--cyan); }
    .line.gate .line-content { color: var(--cyan); }

    .line.human .line-prefix { color: var(--orange); }
    .line.human .line-content { color: var(--text-bright); font-weight: 500; }

    .line.ai .line-prefix { color: var(--accent); }
    .line.ai .line-content { color: var(--text); }

    /* Highlights */
    .hl-green { color: var(--green); }
    .hl-yellow { color: var(--yellow); }
    .hl-red { color: var(--red); }
    .hl-blue { color: var(--blue); }
    .hl-cyan { color: var(--cyan); }
    .hl-accent { color: var(--accent); }
    .hl-pink { color: var(--pink); }
    .hl-orange { color: var(--orange); }
    .hl-dim { color: var(--text-dim); }
    .hl-bright { color: var(--text-bright); font-weight: 600; }

    /* Blocks */
    .block {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 6px;
      margin: 0.75rem 0;
      overflow: hidden;
    }

    .block-header {
      background: var(--bg-tertiary);
      padding: 0.5rem 0.75rem;
      font-size: 0.75rem;
      color: var(--text-dim);
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .block-content {
      padding: 0.75rem;
      font-size: 0.85rem;
    }

    .block-content pre {
      margin: 0;
      white-space: pre-wrap;
    }

    /* Evidence Badge */
    .evidence-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      background: rgba(139, 92, 246, 0.15);
      color: var(--accent);
      font-size: 0.7rem;
      padding: 0.2rem 0.5rem;
      border-radius: 3px;
      margin-left: 0.5rem;
    }

    /* Progress Indicator */
    .progress-line {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin: 1rem 0;
      padding: 0.75rem 1rem;
      background: var(--bg-secondary);
      border-radius: 6px;
      border: 1px solid var(--border);
    }

    .progress-bar {
      flex: 1;
      height: 4px;
      background: var(--border);
      border-radius: 2px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--accent) 0%, var(--green) 100%);
      transition: width 0.3s ease;
    }

    .progress-text {
      font-size: 0.75rem;
      color: var(--text-dim);
      white-space: nowrap;
    }

    /* Typing Cursor */
    .cursor {
      display: inline-block;
      width: 8px;
      height: 1.1em;
      background: var(--accent);
      margin-left: 2px;
      animation: cursor-blink 1s step-end infinite;
      vertical-align: text-bottom;
    }

    @keyframes cursor-blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0; }
    }

    /* Spacer */
    .spacer {
      height: 0.75rem;
    }

    /* Input Area */
    .input-area {
      background: var(--bg-secondary);
      border-top: 1px solid var(--border);
      padding: 1rem 1.5rem;
      flex-shrink: 0;
    }

    .input-row {
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
    }

    .input-prefix {
      color: var(--orange);
      font-weight: 600;
      padding-top: 0.6rem;
      user-select: none;
    }

    .input-wrapper {
      flex: 1;
      position: relative;
    }

    .input-field {
      width: 100%;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 0.6rem 0.85rem;
      font-family: var(--font-mono);
      font-size: 0.9rem;
      color: var(--text-bright);
      resize: none;
      min-height: 42px;
      max-height: 200px;
      line-height: 1.5;
      transition: all 0.15s;
    }

    .input-field:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.15);
    }

    .input-field::placeholder {
      color: var(--text-dim);
    }

    .input-hint {
      font-size: 0.7rem;
      color: var(--text-dim);
      margin-top: 0.5rem;
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .input-hint kbd {
      background: var(--bg-tertiary);
      border: 1px solid var(--border);
      padding: 0.1rem 0.4rem;
      border-radius: 3px;
      font-size: 0.65rem;
    }

    /* Governance Sidebar (collapsible) */
    .sidebar-toggle {
      position: fixed;
      right: 1rem;
      top: 50%;
      transform: translateY(-50%);
      width: 32px;
      height: 80px;
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-right: none;
      border-radius: 6px 0 0 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      color: var(--text-dim);
      font-size: 0.8rem;
      transition: all 0.15s;
      z-index: 100;
    }

    .sidebar-toggle:hover {
      background: var(--bg-tertiary);
      color: var(--text);
    }

    .sidebar {
      position: fixed;
      right: -280px;
      top: 0;
      bottom: 0;
      width: 280px;
      background: var(--bg-secondary);
      border-left: 1px solid var(--border);
      padding: 1rem;
      transition: right 0.3s ease;
      z-index: 99;
      overflow-y: auto;
    }

    .sidebar.open {
      right: 0;
    }

    .sidebar-section {
      margin-bottom: 1.5rem;
    }

    .sidebar-title {
      font-size: 0.7rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--text-dim);
      margin-bottom: 0.75rem;
    }

    .sidebar-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem;
      background: var(--bg-tertiary);
      border-radius: 4px;
      margin-bottom: 0.4rem;
      font-size: 0.8rem;
    }

    .sidebar-item-icon {
      width: 18px;
      height: 18px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.6rem;
      flex-shrink: 0;
    }

    .sidebar-item-icon.pass { background: rgba(34, 197, 94, 0.2); color: var(--green); }
    .sidebar-item-icon.pending { background: rgba(113, 113, 122, 0.2); color: var(--text-dim); }
    .sidebar-item-icon.fail { background: rgba(239, 68, 68, 0.2); color: var(--red); }

    .mai-tag {
      font-size: 0.65rem;
      font-weight: 600;
      padding: 0.2rem 0.4rem;
      border-radius: 3px;
    }

    .mai-tag.advisory { background: rgba(234, 179, 8, 0.2); color: var(--yellow); }
    .mai-tag.mandatory { background: rgba(239, 68, 68, 0.2); color: var(--red); }
    .mai-tag.informational { background: rgba(59, 130, 246, 0.2); color: var(--blue); }

    /* Mobile */
    @media (max-width: 600px) {
      .workflow-tag { display: none; }
      .header-btn span { display: none; }
      .terminal { padding: 0.75rem 1rem; }
      .input-area { padding: 0.75rem 1rem; }
      .sidebar-toggle { display: none; }
    }

    /* Demo Banner */
    .demo-banner {
      background: rgba(59, 130, 246, 0.15);
      border-bottom: 1px solid rgba(59, 130, 246, 0.3);
      padding: 0.4rem 1rem;
      text-align: center;
      font-size: 0.7rem;
      color: var(--blue);
      font-weight: 500;
    }

    /* Capsule Tooltip */
    .capsule-tooltip {
      position: absolute;
      background: var(--bg-secondary);
      border: 1px solid var(--pink);
      border-radius: 6px;
      padding: 0.75rem;
      font-size: 0.7rem;
      z-index: 1000;
      min-width: 240px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.5);
      display: none;
    }

    .capsule-tooltip-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.3rem;
      color: var(--text-dim);
    }

    .capsule-tooltip-row span:last-child {
      color: var(--text);
      font-family: var(--font-mono);
    }

    .capsule-block:hover .capsule-tooltip {
      display: block;
    }

    /* Evidence Modal */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.8);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .modal-overlay.open {
      display: flex;
    }

    .modal {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 8px;
      width: 90%;
      max-width: 700px;
      max-height: 80vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .modal-header {
      padding: 1rem 1.5rem;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: var(--bg-tertiary);
    }

    .modal-title {
      font-size: 1rem;
      font-weight: 600;
      color: var(--accent);
    }

    .modal-close {
      background: none;
      border: none;
      color: var(--text-dim);
      font-size: 1.5rem;
      cursor: pointer;
      line-height: 1;
    }

    .modal-close:hover {
      color: var(--text);
    }

    .modal-content {
      padding: 1.5rem;
      overflow-y: auto;
      font-size: 0.85rem;
    }

    .modal-section {
      margin-bottom: 1.5rem;
    }

    .modal-section-title {
      font-size: 0.7rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--text-dim);
      margin-bottom: 0.75rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .modal-section-title::after {
      content: '';
      flex: 1;
      height: 1px;
      background: var(--border);
    }

    .modal-row {
      display: flex;
      gap: 1rem;
      padding: 0.4rem 0;
      border-bottom: 1px solid var(--border);
    }

    .modal-row:last-child {
      border-bottom: none;
    }

    .modal-label {
      color: var(--text-dim);
      min-width: 120px;
    }

    .modal-value {
      color: var(--text);
      font-family: var(--font-mono);
    }

    .modal-value.pass {
      color: var(--green);
    }

    .modal-value.hash {
      color: var(--cyan);
      font-size: 0.75rem;
    }

    .modal-capsules {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .modal-capsule {
      background: var(--bg-tertiary);
      border: 1px solid var(--pink);
      border-radius: 4px;
      padding: 0.5rem 0.75rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-capsule-name {
      color: var(--pink);
      font-weight: 500;
    }

    .modal-capsule-status {
      font-size: 0.7rem;
      padding: 0.15rem 0.4rem;
      border-radius: 3px;
      background: rgba(34, 197, 94, 0.2);
      color: var(--green);
    }

    /* Confidence/Drift indicators */
    .gov-item .indicator-drift-warn {
      color: var(--yellow);
      animation: drift-pulse 2s infinite;
    }

    @keyframes drift-pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
  </style>
</head>
<body>

  <!-- Demo Banner (shown on Vercel/production) -->
  <div class="demo-banner" id="demoBanner" style="display: none;">
    DEMO MODE ‚Äî No live external calls. Synthetic data only. <a href="#" style="color: var(--cyan); margin-left: 0.5rem;">Learn more</a>
  </div>

  <!-- Evidence Pack Modal -->
  <div class="modal-overlay" id="evidenceModal">
    <div class="modal">
      <div class="modal-header">
        <span class="modal-title">üì¶ Evidence Pack Viewer</span>
        <button class="modal-close" id="modalClose">&times;</button>
      </div>
      <div class="modal-content">
        <div class="modal-section">
          <div class="modal-section-title">Run Metadata</div>
          <div class="modal-row"><span class="modal-label">Workflow ID</span><span class="modal-value">WF-2026-0204-BD-001</span></div>
          <div class="modal-row"><span class="modal-label">Operator</span><span class="modal-value">william@ace.io</span></div>
          <div class="modal-row"><span class="modal-label">Mode</span><span class="modal-value">DEMO (synthetic)</span></div>
          <div class="modal-row"><span class="modal-label">Started</span><span class="modal-value" id="modalStartTime">--</span></div>
          <div class="modal-row"><span class="modal-label">Duration</span><span class="modal-value" id="modalDuration">--</span></div>
        </div>

        <div class="modal-section">
          <div class="modal-section-title">Sources & Hashes</div>
          <div class="modal-row"><span class="modal-label">Primary Source</span><span class="modal-value">SAM.gov API (sandbox)</span></div>
          <div class="modal-row"><span class="modal-label">Query Hash</span><span class="modal-value hash">sha256:9f3a7c2d...e8b1</span></div>
          <div class="modal-row"><span class="modal-label">Response Hash</span><span class="modal-value hash">sha256:4a2f8b1c...d9e3</span></div>
          <div class="modal-row"><span class="modal-label">Evidence Sealed</span><span class="modal-value pass">VERIFIED</span></div>
        </div>

        <div class="modal-section">
          <div class="modal-section-title">Capsule Reuse Log</div>
          <div class="modal-capsules" id="modalCapsules">
            <div class="modal-capsule">
              <span class="modal-capsule-name">NAICS-541512-RANKING</span>
              <span class="modal-capsule-status">HIT - $0.12 saved</span>
            </div>
            <div class="modal-capsule">
              <span class="modal-capsule-name">AFRL-WIN-THEMES</span>
              <span class="modal-capsule-status">HIT - $0.08 saved</span>
            </div>
          </div>
        </div>

        <div class="modal-section">
          <div class="modal-section-title">Gate Approvals</div>
          <div class="modal-row"><span class="modal-label">Gate 1</span><span class="modal-value pass">Domain Authorization ‚úì</span></div>
          <div class="modal-row"><span class="modal-label">Gate 2</span><span class="modal-value pass">MAI Classification ‚úì</span></div>
          <div class="modal-row"><span class="modal-label">Gate 3</span><span class="modal-value pass">Cost Budget ‚úì</span></div>
          <div class="modal-row"><span class="modal-label">Gate 4</span><span class="modal-value" id="modalGate4">Pending...</span></div>
        </div>

        <div class="modal-section">
          <div class="modal-section-title">Exported Artifacts</div>
          <div class="modal-row"><span class="modal-label">capture-plan.pdf</span><span class="modal-value">demo/artifacts/[hash].pdf</span></div>
          <div class="modal-row"><span class="modal-label">competitive-matrix.xlsx</span><span class="modal-value">demo/artifacts/[hash].xlsx</span></div>
          <div class="modal-row"><span class="modal-label">action-tracker.csv</span><span class="modal-value">demo/artifacts/[hash].csv</span></div>
          <div class="modal-row"><span class="modal-label">evidence-pack.json</span><span class="modal-value">demo/artifacts/[hash].json</span></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Header -->
  <header class="header">
    <div class="header-left">
      <div class="logo">
        <div class="logo-icon">G</div>
        <span>GIA</span>
      </div>
      <div class="workflow-tag" id="workflowTag">WF-2026-0204-BD-001</div>
      <div class="status-pill running" id="statusPill">
        <span class="status-dot"></span>
        <span id="statusText">running</span>
      </div>
      <div class="mode-tag" id="modeTag">DEMO</div>
      <button class="header-btn" id="evidenceBtn" title="View Evidence Pack">üì¶</button>
    </div>
    <div class="header-right">
      <div class="cost-tag" id="costTag">$0.00</div>
      <button class="header-btn" id="pauseBtn">
        <span>pause</span> ‚è∏
      </button>
      <button class="header-btn danger" id="abortBtn">
        <span>abort</span> ‚õî
      </button>
      <button class="header-btn" id="helpBtn" title="Keyboard shortcuts">
        ?
      </button>
    </div>
  </header>

  <!-- Governance Banner -->
  <div class="governance-banner" id="governanceBanner">
    <span class="gov-item"><span class="gov-icon">‚ö°</span> MAI: <span class="hl-yellow">ADVISORY</span></span>
    <span class="gov-divider">|</span>
    <span class="gov-item"><span class="gov-icon">üì¶</span> ECV: <span class="hl-green">ACTIVE</span></span>
    <span class="gov-divider">|</span>
    <span class="gov-item"><span class="gov-icon">üö´</span> Gate: <span class="hl-cyan">REQUIRED</span></span>
    <span class="gov-divider">|</span>
    <span class="gov-item"><span class="gov-icon">‚ö†</span> Risk: <span class="hl-yellow" id="riskLevel">MODERATE</span></span>
    <span class="gov-divider">|</span>
    <span class="gov-item"><span class="gov-icon">üîí</span> Integrity: <span class="hl-green" id="integrityStatus">VERIFIED</span></span>
    <span class="gov-divider">|</span>
    <span class="gov-item"><span class="gov-icon">ü§ñ</span> Autonomy: <span class="hl-cyan" id="autonomyLevel">ASSISTED</span></span>
    <span class="gov-divider">|</span>
    <span class="gov-item"><span class="gov-icon">üéØ</span> Confidence: <span class="hl-green" id="confidenceLevel">HIGH</span></span>
    <span class="gov-divider">|</span>
    <span class="gov-item"><span class="gov-icon">üîÑ</span> Drift: <span class="hl-green" id="driftStatus">CLEAN</span></span>
  </div>

  <!-- Metrics Bar -->
  <div class="metrics-bar" id="metricsBar">
    <span class="metric-item">
      <span class="metric-label">Time to Decision</span>
      <span class="metric-value" id="timeMetric">00:00</span>
    </span>
    <span class="metric-item">
      <span class="metric-label">API Calls</span>
      <span class="metric-value" id="apiCallsMetric">0</span>
    </span>
    <span class="metric-item">
      <span class="metric-label">Gates Passed</span>
      <span class="metric-value" id="gatesMetric">0/0</span>
    </span>
    <span class="metric-item">
      <span class="metric-label">Interrupts</span>
      <span class="metric-value" id="interruptsMetric">0</span>
    </span>
    <span class="metric-item">
      <span class="metric-label">Capsule Hits</span>
      <span class="metric-value" id="capsuleHitsMetric" style="color: var(--pink);">0</span>
    </span>
    <span class="metric-item compliance-tag">
      <span class="metric-label">Compliance</span>
      <span class="metric-value">FAR ¬∑ NIST 800-53</span>
    </span>
  </div>

  <!-- Terminal -->
  <div class="terminal-container">
    <div class="terminal" id="terminal"></div>

    <!-- Input Area -->
    <div class="input-area">
      <div class="input-row">
        <span class="input-prefix">you:</span>
        <div class="input-wrapper">
          <textarea
            class="input-field"
            id="inputField"
            placeholder="interrupt, re-scope, or add constraints..."
            rows="1"
          ></textarea>
        </div>
      </div>
      <div class="input-hint">
        <span><kbd>Enter</kbd> send</span>
        <span><kbd>Esc</kbd> clear</span>
        <span class="hl-dim">|</span>
        <span style="color: var(--green);">‚óè input always active</span>
      </div>
    </div>
  </div>

  <!-- Sidebar Toggle -->
  <div class="sidebar-toggle" id="sidebarToggle">‚óÄ</div>

  <!-- Sidebar -->
  <div class="sidebar" id="sidebar">
    <div class="sidebar-section">
      <div class="sidebar-title">Governance Status</div>
      <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.75rem;">
        <span style="font-size: 0.8rem;">MAI Classification:</span>
        <span class="mai-tag advisory">ADVISORY</span>
      </div>
      <div class="sidebar-item">
        <div class="sidebar-item-icon pass">‚úì</div>
        <span>Domain authorized</span>
      </div>
      <div class="sidebar-item">
        <div class="sidebar-item-icon pass">‚úì</div>
        <span>Cost: $0.14 / $5.00</span>
      </div>
      <div class="sidebar-item">
        <div class="sidebar-item-icon pass">‚úì</div>
        <span>Data classification</span>
      </div>
      <div class="sidebar-item">
        <div class="sidebar-item-icon pending">‚óã</div>
        <span style="color: var(--text-dim);">Output review</span>
      </div>
    </div>

    <div class="sidebar-section">
      <div class="sidebar-title">Evidence Pack</div>
      <div class="sidebar-item">
        <span>üì∏</span>
        <span>3 screenshots</span>
      </div>
      <div class="sidebar-item">
        <span>üîó</span>
        <span>2 API calls logged</span>
      </div>
      <div class="sidebar-item">
        <span>üí¨</span>
        <span>0 interrupts</span>
      </div>
    </div>

    <div class="sidebar-section">
      <div class="sidebar-title">Run Info</div>
      <div style="font-size: 0.75rem; color: var(--text-dim); line-height: 1.8;">
        <div><span class="hl-dim">ID:</span> GIA-2026-0204-1547</div>
        <div><span class="hl-dim">Domain:</span> BD Capture</div>
        <div><span class="hl-dim">Operator:</span> william@ace.io</div>
        <div><span class="hl-dim">Started:</span> 15:47:22</div>
      </div>
    </div>
  </div>

  <script>
    // ============================================
    // DEMO MODE HARD-LOCK FOR PRODUCTION SAFETY
    // ============================================
    const IS_VERCEL = window.location.hostname.includes('vercel.app') ||
                       window.location.hostname.includes('.vercel.') ||
                       typeof process !== 'undefined' && process.env?.VERCEL === '1';
    const FORCE_DEMO = true; // Always demo for now - flip to false for local live testing
    const IS_DEMO_MODE = IS_VERCEL || FORCE_DEMO;

    // If on Vercel, forcibly set demo mode indicator
    if (IS_DEMO_MODE) {
      console.log('[GIA] Running in DEMO mode - no live external calls');
    }

    const terminal = document.getElementById('terminal');
    const inputField = document.getElementById('inputField');
    const statusPill = document.getElementById('statusPill');
    const statusText = document.getElementById('statusText');
    const pauseBtn = document.getElementById('pauseBtn');
    const sidebar = document.getElementById('sidebar');
    const sidebarToggle = document.getElementById('sidebarToggle');

    let isPaused = false;
    let interruptCount = 0;
    let currentCost = 0;
    let apiCalls = 0;
    let gatesPassed = 0;
    let totalGates = 4;
    let startTime = Date.now();

    const costTag = document.getElementById('costTag');
    const timeMetric = document.getElementById('timeMetric');
    const apiCallsMetric = document.getElementById('apiCallsMetric');
    const gatesMetric = document.getElementById('gatesMetric');
    const interruptsMetric = document.getElementById('interruptsMetric');
    const integrityStatus = document.getElementById('integrityStatus');
    const riskLevel = document.getElementById('riskLevel');
    const capsuleHitsMetric = document.getElementById('capsuleHitsMetric');
    const confidenceLevel = document.getElementById('confidenceLevel');
    const driftStatus = document.getElementById('driftStatus');
    let capsuleHits = 0;

    // Show demo banner if in demo mode
    if (IS_DEMO_MODE) {
      document.getElementById('demoBanner').style.display = 'block';
      document.getElementById('modeTag').textContent = 'DEMO';
      document.getElementById('modeTag').classList.remove('live');
    }

    // Evidence Modal
    const evidenceModal = document.getElementById('evidenceModal');
    const evidenceBtn = document.getElementById('evidenceBtn');
    const modalClose = document.getElementById('modalClose');

    evidenceBtn.addEventListener('click', () => {
      // Update modal with current data
      document.getElementById('modalStartTime').textContent = new Date(startTime).toISOString().replace('T', ' ').substr(0, 19);
      document.getElementById('modalDuration').textContent = timeMetric.textContent;
      document.getElementById('modalGate4').textContent = gatesPassed >= 4 ? 'Export Approved ‚úì' : 'Pending...';
      document.getElementById('modalGate4').className = gatesPassed >= 4 ? 'modal-value pass' : 'modal-value';
      evidenceModal.classList.add('open');
    });

    modalClose.addEventListener('click', () => {
      evidenceModal.classList.remove('open');
    });

    evidenceModal.addEventListener('click', (e) => {
      if (e.target === evidenceModal) {
        evidenceModal.classList.remove('open');
      }
    });

    // Confidence and Drift functions
    function setConfidence(level) {
      confidenceLevel.textContent = level;
      if (level === 'HIGH') {
        confidenceLevel.className = 'hl-green';
      } else if (level === 'MEDIUM') {
        confidenceLevel.className = 'hl-yellow';
      } else if (level === 'LOW') {
        confidenceLevel.className = 'hl-red';
      }
    }

    function setDrift(status) {
      driftStatus.textContent = status;
      if (status === 'CLEAN') {
        driftStatus.className = 'hl-green';
      } else if (status === 'POLICY CHANGED') {
        driftStatus.className = 'indicator-drift-warn';
      } else if (status === 'INVALIDATED') {
        driftStatus.className = 'hl-red';
      }
    }

    // Update timer every second
    setInterval(() => {
      if (statusText.textContent === 'running' || statusText.textContent === 'processing') {
        const elapsed = Math.floor((Date.now() - startTime) / 1000);
        const mins = Math.floor(elapsed / 60).toString().padStart(2, '0');
        const secs = (elapsed % 60).toString().padStart(2, '0');
        timeMetric.textContent = `${mins}:${secs}`;
      }
    }, 1000);

    function updateApiCalls() {
      apiCalls++;
      apiCallsMetric.textContent = apiCalls;
    }

    function updateGates(passed) {
      gatesPassed = passed;
      gatesMetric.textContent = `${gatesPassed}/${totalGates}`;
      gatesMetric.style.color = gatesPassed === totalGates ? 'var(--green)' : 'var(--text-bright)';
    }

    function updateInterrupts() {
      interruptsMetric.textContent = interruptCount;
      if (interruptCount > 0) {
        interruptsMetric.style.color = 'var(--orange)';
      }
    }

    function setIntegrity(status) {
      integrityStatus.textContent = status;
      if (status === 'VERIFIED') {
        integrityStatus.className = 'hl-green';
      } else if (status === 'DRIFT ‚ö†Ô∏è') {
        integrityStatus.className = 'hl-red';
      }
    }

    function setRisk(level) {
      riskLevel.textContent = level;
      if (level === 'LOW') riskLevel.className = 'hl-green';
      else if (level === 'MODERATE') riskLevel.className = 'hl-yellow';
      else if (level === 'HIGH') riskLevel.className = 'hl-red';
    }

    function updateCost(amount) {
      currentCost += amount;
      costTag.textContent = '$' + currentCost.toFixed(2);
      if (currentCost > 1) {
        costTag.className = 'cost-tag warning';
      }
      if (currentCost > 4) {
        costTag.className = 'cost-tag danger';
      }
    }

    function addEvidencePack(packId, data) {
      const block = document.createElement('div');
      block.className = 'evidence-block';
      block.innerHTML = `
        <div class="evidence-header">üì¶ Evidence Pack: ${packId}</div>
        <div class="evidence-content">
          <div class="evidence-row"><span class="evidence-label">Source:</span><span class="evidence-value">${data.source}</span></div>
          <div class="evidence-row"><span class="evidence-label">Endpoint:</span><span class="evidence-value">${data.endpoint}</span></div>
          <div class="evidence-row"><span class="evidence-label">Query Hash:</span><span class="evidence-value">${data.queryHash}</span></div>
          <div class="evidence-row"><span class="evidence-label">Timestamp:</span><span class="evidence-value">${data.timestamp}</span></div>
          <div class="evidence-row"><span class="evidence-label">Validation:</span><span class="evidence-value evidence-pass">${data.validation}</span></div>
          ${data.negativeAssurance ? `<div class="evidence-row"><span class="evidence-label">‚ö† Note:</span><span class="evidence-value evidence-warn">${data.negativeAssurance}</span></div>` : ''}
        </div>
      `;
      terminal.appendChild(block);
      scrollToBottom();
    }

    function addCapsule(capsuleId, data) {
      const block = document.createElement('div');
      block.className = 'capsule-block';
      block.style.position = 'relative';

      // Generate provenance data
      const packVersion = data.version || 'v1.0.0';
      const inputHash = data.inputHash || 'sha256:' + Math.random().toString(36).substr(2, 8) + '...';
      const ttlCountdown = data.ttl || '30d';
      const lastValidated = new Date().toISOString().replace('T', ' ').substr(0, 19);

      block.innerHTML = `
        <div class="capsule-header">
          <div class="capsule-header-left">
            <span>üíä Capsule: ${capsuleId}</span>
            <span class="capsule-badge ${data.status}">${data.status.toUpperCase()}</span>
          </div>
          <span style="font-size: 0.65rem; color: var(--text-dim);">${data.type}</span>
        </div>
        <div class="capsule-content">
          <div style="color: var(--text);">${data.description}</div>
          <div class="capsule-stats">
            <span class="capsule-stat">‚ö° Tokens: <span class="capsule-stat-value">${data.tokens || '0'}</span></span>
            <span class="capsule-stat">üîÑ Reuses: <span class="capsule-stat-value">${data.reuses || '0'}</span></span>
            <span class="capsule-stat">üí∞ Saved: <span class="capsule-stat-value">$${data.saved || '0.00'}</span></span>
            ${data.ttl ? `<span class="capsule-stat">‚è± TTL: <span class="capsule-stat-value">${data.ttl}</span></span>` : ''}
          </div>
        </div>
        <div class="capsule-tooltip" style="top: 100%; left: 0; margin-top: 4px;">
          <div class="capsule-tooltip-row"><span>Pack Version:</span><span>${packVersion}</span></div>
          <div class="capsule-tooltip-row"><span>Input Hash:</span><span>${inputHash}</span></div>
          <div class="capsule-tooltip-row"><span>TTL Countdown:</span><span>${ttlCountdown}</span></div>
          <div class="capsule-tooltip-row"><span>Last Validated:</span><span>${lastValidated}</span></div>
        </div>
      `;
      terminal.appendChild(block);
      scrollToBottom();
    }

    function addInstructionPack(packName, steps) {
      const block = document.createElement('div');
      block.className = 'instruction-pack';
      block.id = `pack-${packName.replace(/\s/g, '-').toLowerCase()}`;
      const stepsHtml = steps.map((step, i) => `
        <div class="instruction-step" data-step="${i}">
          <span class="instruction-step-num">${i + 1}.</span>
          <span class="instruction-step-text">${step}</span>
        </div>
      `).join('');

      block.innerHTML = `
        <div class="instruction-header">
          <span>üì¶ Instruction Pack: ${packName}</span>
          <span style="margin-left: auto; font-size: 0.65rem; color: var(--text-dim);">${steps.length} steps</span>
        </div>
        <div class="instruction-content">${stepsHtml}</div>
      `;
      terminal.appendChild(block);
      scrollToBottom();
      return block;
    }

    function updateInstructionStep(packElement, stepIndex, status) {
      const step = packElement.querySelector(`[data-step="${stepIndex}"]`);
      if (step) {
        step.className = `instruction-step ${status}`;
      }
    }

    function addGatePrompt(gateId, message, onApprove, onModify, onAbort) {
      const gate = document.createElement('div');
      gate.className = 'gate-prompt';
      gate.id = gateId;
      gate.innerHTML = `
        <div class="gate-prompt-header">üö´ MANDATORY GATE ‚Äî Human Approval Required</div>
        <div class="gate-prompt-text">${message}</div>
        <div class="gate-prompt-actions">
          <button class="gate-btn primary" data-action="approve">‚úì APPROVE</button>
          <button class="gate-btn" data-action="modify">‚úé MODIFY</button>
          <button class="gate-btn danger" data-action="abort">‚úó ABORT</button>
        </div>
      `;
      terminal.appendChild(gate);
      scrollToBottom();

      gate.querySelector('[data-action="approve"]').addEventListener('click', () => {
        gate.remove();
        onApprove && onApprove();
      });
      gate.querySelector('[data-action="modify"]').addEventListener('click', () => {
        gate.remove();
        onModify && onModify();
      });
      gate.querySelector('[data-action="abort"]').addEventListener('click', () => {
        gate.remove();
        onAbort && onAbort();
      });
    }

    // Toggle sidebar
    sidebarToggle.addEventListener('click', () => {
      sidebar.classList.toggle('open');
      sidebarToggle.textContent = sidebar.classList.contains('open') ? '‚ñ∂' : '‚óÄ';
    });

    // Auto-resize textarea
    inputField.addEventListener('input', function() {
      this.style.height = 'auto';
      this.style.height = Math.min(this.scrollHeight, 200) + 'px';
    });

    // Handle input
    inputField.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        submitInput();
      }
    });

    function submitInput() {
      const text = inputField.value.trim();
      if (!text) return;

      interruptCount++;
      updateInterrupts();

      // Add human line
      addLine('human', 'you:', text);
      addSpacer();

      // Process interrupt
      processInterrupt(text);

      inputField.value = '';
      inputField.style.height = 'auto';
    }

    function addLine(type, prefix, content, extras = '') {
      const line = document.createElement('div');
      line.className = `line ${type}`;
      line.innerHTML = `
        <span class="line-prefix">${prefix}</span>
        <span class="line-content">${content}${extras}</span>
      `;
      terminal.appendChild(line);
      scrollToBottom();
    }

    function addSpacer() {
      const spacer = document.createElement('div');
      spacer.className = 'spacer';
      terminal.appendChild(spacer);
    }

    function addBlock(title, content) {
      const block = document.createElement('div');
      block.className = 'block';
      block.innerHTML = `
        <div class="block-header">${title}</div>
        <div class="block-content"><pre>${content}</pre></div>
      `;
      terminal.appendChild(block);
      scrollToBottom();
    }

    function addProgress(percent, text) {
      const existing = terminal.querySelector('.progress-line');
      if (existing) existing.remove();

      const progress = document.createElement('div');
      progress.className = 'progress-line';
      progress.innerHTML = `
        <span class="progress-text">${text}</span>
        <div class="progress-bar">
          <div class="progress-fill" style="width: ${percent}%"></div>
        </div>
        <span class="progress-text">${percent}%</span>
      `;
      terminal.appendChild(progress);
      scrollToBottom();
    }

    function typeText(type, prefix, text, speed = 15) {
      return new Promise(resolve => {
        const line = document.createElement('div');
        line.className = `line ${type}`;
        const prefixSpan = document.createElement('span');
        prefixSpan.className = 'line-prefix';
        prefixSpan.textContent = prefix;
        const contentSpan = document.createElement('span');
        contentSpan.className = 'line-content';
        const cursor = document.createElement('span');
        cursor.className = 'cursor';

        line.appendChild(prefixSpan);
        line.appendChild(contentSpan);
        contentSpan.appendChild(cursor);
        terminal.appendChild(line);

        let i = 0;
        const interval = setInterval(() => {
          if (i < text.length) {
            contentSpan.insertBefore(document.createTextNode(text[i]), cursor);
            i++;
            scrollToBottom();
          } else {
            clearInterval(interval);
            cursor.remove();
            resolve();
          }
        }, speed);
      });
    }

    function scrollToBottom() {
      terminal.scrollTop = terminal.scrollHeight;
    }

    async function processInterrupt(text) {
      // Update status
      statusPill.className = 'status-pill paused';
      statusText.textContent = 'processing';

      await sleep(300);

      // Show interrupt processing
      await typeText('ai', 'gia:', `interrupt received. pausing workflow...`);
      addSpacer();

      await sleep(400);

      // Log interrupt
      addLine('gate', '‚ö°', `logged interrupt #${interruptCount} to evidence pack`,
        `<span class="evidence-badge">üì¶ recorded</span>`);

      await sleep(300);

      // Re-evaluate
      await typeText('ai', 'gia:', `re-evaluating governance with new constraint...`);

      await sleep(500);

      addLine('gate', '‚úì', `MAI classification unchanged: <span class="hl-yellow">ADVISORY</span>`);
      addLine('gate', '‚úì', `gates re-validated. proceeding.`);

      addSpacer();

      // Resume with constraint
      await typeText('ai', 'gia:', `applying constraint: "${text}"`);

      await sleep(300);

      await typeText('step', '‚Üí', `resuming search with updated parameters...`);

      // Back to running
      statusPill.className = 'status-pill running';
      statusText.textContent = 'running';

      addSpacer();

      // Simulate continued work
      await sleep(800);
      await typeText('output', '  ', `filtering results...`);
      await sleep(500);
      addLine('success', '‚úì', `found <span class="hl-bright">12</span> opportunities matching updated criteria`);

      addSpacer();
    }

    function sleep(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }

    // Pause button
    pauseBtn.addEventListener('click', () => {
      isPaused = !isPaused;
      if (isPaused) {
        statusPill.className = 'status-pill paused';
        statusText.textContent = 'paused';
        pauseBtn.innerHTML = '<span>resume</span> ‚ñ∂';
        addLine('warning', '‚è∏', 'workflow paused by operator');
      } else {
        statusPill.className = 'status-pill running';
        statusText.textContent = 'running';
        pauseBtn.innerHTML = '<span>pause</span> ‚è∏';
        addLine('success', '‚ñ∂', 'workflow resumed');
      }
      addSpacer();
    });

    // Initial demo sequence
    async function runDemo() {
      addLine('system', '‚óÜ', `<span class="hl-accent">GIA Console</span> v0.1.0 ‚Äî governed AI execution terminal`);
      addLine('system', '‚óÜ', `type anytime to interrupt, re-scope, or add constraints`);
      addSpacer();

      await sleep(500);

      addLine('gate', '‚ö°', `run initialized: <span class="hl-bright">WF-2026-0204-BD-001</span>`);
      addLine('gate', '‚úì', `domain: <span class="hl-cyan">BD Capture</span> ‚Äî authorized`);
      updateGates(1);
      addLine('gate', '‚úì', `MAI classification: <span class="hl-yellow">ADVISORY</span>`);
      updateGates(2);
      addLine('gate', '‚úì', `cost budget: $5.00 ‚Äî approved`);
      updateGates(3);
      addSpacer();

      await sleep(600);

      // Show Instruction Pack
      const pack = addInstructionPack('Federal Opportunity Search', [
        'Parse search criteria from input',
        'Connect to SAM.gov API',
        'Execute search query',
        'Rank by relevance + deadline',
        'Generate evidence pack',
        'Present results for approval'
      ]);
      addSpacer();

      await sleep(500);

      await typeText('step', '‚Üí', 'starting workflow: federal-opportunity-search');
      updateCost(0.01);
      addSpacer();

      // Step 1
      updateInstructionStep(pack, 0, 'active');
      await sleep(400);

      await typeText('output', '  ', 'parsing search criteria...');
      await sleep(300);
      addBlock('search parameters', `keywords:   ["AI/ML", "cybersecurity", "cloud"]
naics:      541512, 541511
set-aside:  null
min-value:  $100,000`);
      updateInstructionStep(pack, 0, 'done');

      await sleep(500);

      // Step 2
      updateInstructionStep(pack, 1, 'active');
      await typeText('step', '‚Üí', 'connecting to SAM.gov API...');
      await sleep(800);
      addLine('success', '‚úì', 'connection established');
      updateCost(0.02);
      updateApiCalls();
      updateInstructionStep(pack, 1, 'done');
      addSpacer();

      await sleep(400);

      // Step 3
      updateInstructionStep(pack, 2, 'active');
      await typeText('step', '‚Üí', 'executing search query...');
      addProgress(30, 'searching');

      await sleep(1000);
      addProgress(65, 'processing');
      updateCost(0.05);

      await sleep(800);
      addProgress(100, 'complete');

      await sleep(300);
      addLine('success', '‚úì', `found <span class="hl-bright">47</span> opportunities matching criteria`);
      updateCost(0.04);
      updateApiCalls();
      updateInstructionStep(pack, 2, 'done');
      addSpacer();

      // Show cached capsule - this is where the magic happens
      await sleep(400);
      addCapsule('NAICS-541512-RANKING', {
        status: 'cached',
        type: 'Ranking Algorithm',
        description: 'Pre-trained relevance model for IT Professional Services (NAICS 541512)',
        tokens: '0',
        reuses: '47',
        saved: '0.12',
        ttl: '7d'
      });

      // Step 4
      updateInstructionStep(pack, 3, 'active');
      await sleep(400);

      await typeText('step', '‚Üí', 'applying cached ranking capsule...');
      await sleep(300);
      capsuleHits++;
      capsuleHitsMetric.textContent = capsuleHits;
      addLine('success', '‚úì', `<span class="hl-pink">capsule hit</span> ‚Äî zero API calls for ranking`);
      updateInstructionStep(pack, 3, 'done');
      addSpacer();

      // Step 5
      updateInstructionStep(pack, 4, 'active');

      // Evidence Pack
      await sleep(400);
      addEvidencePack('FED-SEARCH-2026-0204-001', {
        source: 'SAM.gov API',
        endpoint: '/opportunities/v2/search',
        queryHash: '9f3a7c2d...e8b1',
        timestamp: new Date().toISOString(),
        validation: 'PASSED',
        negativeAssurance: 'No set-aside filter applied'
      });
      updateInstructionStep(pack, 4, 'done');

      await sleep(500);

      await typeText('output', '  ', 'applying relevance weights from capsule...');
      await sleep(400);
      await typeText('output', '  ', 'calculating deadline proximity scores...');
      await sleep(500);

      addSpacer();
      addLine('success', '‚úì', `ranked <span class="hl-bright">Top 5</span> opportunities by relevance`);

      // Step 6
      updateInstructionStep(pack, 5, 'active');
      addSpacer();

      addBlock('top 5 results', `1. FA8750-26-R-0042  AI/ML Platform Services      95%  $4.2M   Due: Mar 15
2. W911NF-26-R-0089  Cyber Defense Analytics     91%  $2.8M   Due: Mar 22
3. N00024-26-R-0156  Cloud Migration Services    88%  $1.9M   Due: Apr 01
4. FA8075-26-R-0201  Data Engineering Support    85%  $3.1M   Due: Apr 10
5. W56KGU-26-R-0044  AI Training Infrastructure  82%  $5.6M   Due: Apr 18`);

      updateCost(0.02);
      await sleep(800);

      // Gate prompt before export
      addSpacer();
      addGatePrompt('gate-export',
        'Ready to export shortlist and generate capture plan. This action will create external artifacts.',
        async () => {
          addLine('gate', '‚úì', 'Gate APPROVED by operator');
          updateGates(4);
          updateInstructionStep(pack, 5, 'done');
          addSpacer();

          // Phase 2: Post-approval workflow
          await typeText('step', '‚Üí', 'initiating capture plan generation...');
          await sleep(600);

          await typeText('output', '  ', 'loading opportunity details for FA8750-26-R-0042...');
          updateApiCalls();
          await sleep(400);

          await typeText('output', '  ', 'analyzing solicitation requirements...');
          updateCost(0.03);
          await sleep(500);

          addBlock('opportunity summary', `Solicitation:  FA8750-26-R-0042
Title:         AI/ML Platform Services for AFRL
Agency:        Air Force Research Laboratory
Value:         $4.2M (ceiling)
Type:          IDIQ, Task Order
Set-Aside:     Full & Open
Due:           March 15, 2026
POC:           sarah.chen@us.af.mil`);

          await sleep(500);

          await typeText('step', '‚Üí', 'generating win theme recommendations...');
          await sleep(400);

          // Use another cached capsule
          addCapsule('AFRL-WIN-THEMES', {
            status: 'cached',
            type: 'Win Theme Library',
            description: 'Historical win themes for Air Force Research Lab contracts',
            tokens: '0',
            reuses: '12',
            saved: '0.08',
            ttl: '90d'
          });

          capsuleHits++;
          capsuleHitsMetric.textContent = capsuleHits;
          addLine('success', '‚úì', `<span class="hl-pink">capsule hit</span> ‚Äî win themes loaded from cache`);
          addSpacer();

          await sleep(400);

          addBlock('recommended win themes', `1. Technical Excellence
   ‚Üí Emphasize AI/ML model governance and explainability
   ‚Üí Highlight cleared personnel with AFRL experience

2. Mission Alignment
   ‚Üí Reference AFRL's AI strategy and research priorities
   ‚Üí Connect capabilities to specific lab directorates

3. Past Performance
   ‚Üí Cite similar IDIQ work with DoD research labs
   ‚Üí Include quantified outcomes and cost savings`);

          await sleep(600);

          await typeText('step', '‚Üí', 'compiling capture plan document...');
          await sleep(400);
          await typeText('output', '  ', 'adding competitive analysis...');
          await sleep(300);
          await typeText('output', '  ', 'inserting team structure recommendations...');
          await sleep(300);
          await typeText('output', '  ', 'finalizing executive summary...');
          await sleep(500);

          addLine('success', '‚úì', 'capture plan compiled (12 pages)');
          addSpacer();

          // Final export
          await typeText('step', '‚Üí', 'exporting artifacts...');
          await sleep(400);

          // Sandboxed artifact paths - no real filesystem exposure
          const artifactHash = Math.random().toString(36).substr(2, 8);
          addBlock('exported files', `üìÑ demo/artifacts/${artifactHash}-capture.pdf     12 pages
üìä demo/artifacts/${artifactHash}-matrix.xlsx      3 competitors
üìã demo/artifacts/${artifactHash}-tracker.csv      14 tasks
üì¶ demo/artifacts/${artifactHash}-evidence.json    full audit trail

Note: Artifacts stored in sandboxed demo environment`);

          addSpacer();

          // Create reusable capsule from this run
          addCapsule('BD-SEARCH-AIML-2026', {
            status: 'new',
            type: 'Search Template',
            description: 'AI/ML federal opportunity search ‚Äî reusable for similar queries',
            tokens: '1,247',
            reuses: '0',
            saved: '0.00',
            ttl: '30d'
          });
          addLine('system', '‚óÜ', '<span class="hl-pink">capsule saved</span> ‚Üí future AI/ML searches will skip ranking step');
          addSpacer();

          // Final summary
          setIntegrity('VERIFIED');
          setRisk('LOW');

          addLine('gate', 'üì¶', 'evidence pack sealed: <span class="hl-accent">FED-SEARCH-2026-0204-001</span>');
          addSpacer();

          // Completion summary block
          addBlock('workflow summary', `Status:        COMPLETE ‚úì
Duration:      ${timeMetric.textContent}
API Calls:     ${apiCalls}
Capsule Hits:  ${capsuleHits} (saved ~$0.20)
Total Cost:    ${costTag.textContent}
Artifacts:     4 files exported
Evidence:      Sealed and verified`);

          addSpacer();
          addLine('system', '‚óÜ', '<span class="hl-green">workflow complete.</span> all actions logged and auditable.');
          addLine('system', '‚óÜ', '<span class="hl-dim">type "new search" to start another workflow</span>');

          statusPill.className = 'status-pill paused';
          statusText.textContent = 'complete';
          document.getElementById('modeTag').textContent = 'COMPLETE';
          document.getElementById('modeTag').style.background = 'rgba(34, 197, 94, 0.15)';
          document.getElementById('modeTag').style.color = 'var(--green)';
          document.getElementById('modeTag').style.borderColor = 'rgba(34, 197, 94, 0.3)';
        },
        () => {
          addLine('warning', '‚úé', 'Gate MODIFY requested ‚Äî awaiting new constraints');
          addSpacer();
          addLine('system', '‚óÜ', '<span class="hl-dim">type your modifications below</span>');
        },
        () => {
          addLine('error', '‚úó', 'Gate ABORTED by operator');
          addSpacer();
          setIntegrity('SEALED');
          addLine('gate', 'üì¶', 'evidence pack sealed ‚Äî no export performed');
          statusPill.className = 'status-pill paused';
          statusText.textContent = 'aborted';
          document.getElementById('modeTag').textContent = 'ABORTED';
          document.getElementById('modeTag').style.background = 'rgba(239, 68, 68, 0.15)';
          document.getElementById('modeTag').style.color = 'var(--red)';
          document.getElementById('modeTag').style.borderColor = 'rgba(239, 68, 68, 0.3)';
        }
      );
    }

    // Help button
    document.getElementById('helpBtn').addEventListener('click', () => {
      addSpacer();
      addLine('system', '‚óÜ', '<span class="hl-accent">GIA Console Help</span>');
      addLine('system', '  ', '<span class="hl-dim">Enter</span>        ‚Äî send interrupt/constraint');
      addLine('system', '  ', '<span class="hl-dim">Shift+Enter</span> ‚Äî new line in input');
      addLine('system', '  ', '<span class="hl-dim">Escape</span>      ‚Äî clear input');
      addLine('system', '  ', '<span class="hl-dim">‚óÄ sidebar</span>   ‚Äî view governance status');
      addSpacer();
      addLine('system', '‚óÜ', '<span class="hl-dim">type anytime to add constraints mid-workflow</span>');
      addSpacer();
    });

    // Abort button
    document.getElementById('abortBtn').addEventListener('click', () => {
      addLine('error', '‚õî', 'workflow aborted by operator');
      addSpacer();
      statusPill.className = 'status-pill paused';
      statusText.textContent = 'aborted';
      addLine('gate', 'üì¶', 'evidence pack sealed ‚Äî partial run archived');
      addSpacer();
      addLine('system', '‚óÜ', '<span class="hl-dim">run terminated. evidence available for review.</span>');
    });

    // Escape to clear input
    inputField.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        inputField.value = '';
        inputField.style.height = 'auto';
      }
    });

    // Start demo
    runDemo();
  </script>

</body>
</html>
